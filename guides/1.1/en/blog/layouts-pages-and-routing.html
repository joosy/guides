<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Layouts, pages and routing — Joosy Guides</title>
    <meta charset='utf-8'>
    <link href='http://joosy.ws/application.css' rel='stylesheet'>
    <link href='//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/assets/application-181f538c3c91d67834001520f603889f.css">
    <script src='http://codeorigin.jquery.com/jquery-1.10.2.min.js' type='text/javascript'></script>
    <script src='//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js' type='text/javascript'></script>
  </head>
  <body>
    <nav class='navbar navbar-inverse'>
      <div class='container'>
        <div class='collapse navbar-collapse'>
          <ul class='nav navbar-nav'>
            <li>
              <a href='http://joosy.ws'>
                Joosy
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Download
              </a>
            </li>
            <li class='active'>
              <a href='http://guides.joosy.ws'>
                Guides
              </a>
            </li>
            <li>
              <a href='http://api.joosy.ws'>
                API
              </a>
            </li>
            <li>
              <a href='http://sample.joosy.ws/routes.js.coffee.html'>
                Annotated sample
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Screencasts
              </a>
            </li>
            <li>
              <a href='http://github.com/joosy/joosy/issues'>
                Bugs
              </a>
            </li>
            <li>
              <a href='javascript:void(0)'>
                Community
              </a>
            </li>
            <li class='twitter'>
              <a href="https://twitter.com/joosy_web" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Twitter</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class='content'>
  <header>
    <div class='container'>
      <img class='pull-left logo' src='http://joosy.ws/joosy.png'>
      <p class='pull-left'>
        Guides for version 1.1
        <a href='/'>
          Another version or language?
        </a>
      </p>
      <div class='menu pull-right'>
        <ul class='nav nav-pills'>
          <li class=''>
            <a href='/guides/1.1/en'>
              <i class='icon-archive'></i>
              Index
            </a>
          </li>
          <li class='active'>
            <div id='guides'>
              
              <dl class='pull-left'>
  <dt>Joosy basics</dt>
  <dd>
    <a href='/guides/1.1/en/basics/getting-started.html'>Getting Started</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/basics/joosy-vs-x.html'>Joosy vs X</a>
  </dd>
  <dt class='inner'>Creating a blog on Joosy</dt>
  <dd>
    <a href='/guides/1.1/en/blog/rails-preparations.html'>Rails preparations</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/resources.html'>Resources</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/layouts-pages-and-routing.html'>Layouts, Pages and Routing</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/elements-events-and-filters.html'>Elements, Events and Filters</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/dynamic-rendering.html'>Dynamic rendering</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/widgets.html'>Widgets</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/helpers.html'>Helpers</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/forms.html'>Forms</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/preloaders.html'>Preloaders</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/load-unload-and-in-progress-animations.html'>Load, unload, animations</a>
  </dd>
</dl>
<dl class='pull-right'>
  <dt>Advanced guides</dt>
  <dd>
    <a href='/guides/1.1/en/advanced/search-engines-indexing.html'>Search engine indexing</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/authentication.html'>Authentication</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/permissions-and-acl.html'>Permissions and ACL</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/how-to-switch-template-engine.html'>Template engines</a>
  </dd>
</dl>

            </div>
            <a class='dropdown-toggle' data-target='#guides' data-toggle='dropdown' href='#guides'>
              <i class='icon-long-arrow-down'></i>
              Guides
            </a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  <section class='main'>
    <article class='entry'>
      <div class='entry-header'>
        <h2></h2>
      </div>
      <div class='entry-content l-en v-1-1'>
        <p>In Rails each page is the action template. It gets wrapped into the layout and includes a number of partials. As a result you get your HTML generated.</p>

<p>Joosy behaves the same way but unlike its elder brother it has to deal with events and user interaction logic so it&#39;s not just a renderer. Joosy separates the templates layer from a logic level. Logic level consists of the <code>Page</code>, the <code>Layout</code> which wraps the page and set of <code>Widget</code>s that can be included in both, <code>Page</code> and <code>Layout</code>. Each element of the logic level uses templates to describe rendering.</p>

<p><img src="http://f.cl.ly/items/1S130q3C0n1s2R1I1T0S/pages.png" alt=""></p>

<div class="info">
  <p>
    Joosy tries to keep logic elements alive as long as possible. When the new page gets loaded, current layout (object instance, bindings, DOM, included widgets, etc.) will stay untouched unless new pages require another layout. In this case Page will be linked to an existing instance.
  </p>
</div>

<h2>Layouts</h2>

<p>With your first app you got your first page and layout generated. They are situated in</p>

<div class="black_wheel">
  <pre>pages/welcome/index.js.coffee
layouts/application.js.coffee</pre>
</div>

<p>We&#39;ll start from the Layout. The only option it sets makes Joosy look for a template for this layout at <code>templates/layouts/application.jst.hamlc</code>. Since we don&#39;t really need any logic at our Layout for now let&#39;s just modify the HAML. Using twitter bootstrap we can come up with something like this:</p>

<script src="http://gist.github.com/2785784.js?file=Layout.haml">// Gist is loading...</script>

<p>Take a look at the last tricky line. Using <code>{:id =&gt; @yield()}</code> we mark the <code>.container</code> div with the special ID Joosy will use to include page&#39;s HTML. Again, with that, we&#39;ll get page HTML right inside our <code>.container</code> div. And that&#39;s pretty much everything we need from the Layout for now.</p>

<div class="info">
  <p>
    This may look like a silly name 'cause it clearly is not an `yield` in it's real meaning. But wait! Listen! We had a reason to use this name. It helps you to not remember another `longMethodToCall`. It mimics Rails in the closest possible way. 
  </p>
</div>

<h2>Pages</h2>

<p>Let&#39;s move on to the pages. To structure application better we will not use the default pregenerated page (we&#39;ll remove it later) but create a set of new ones! We&#39;ll need three pages: the list of posts, single post view and two forms – to create the post and edit it. We&#39;ll get to modification while working with forms, so now let&#39;s generate the list and view pages:</p>

<script src="http://gist.github.com/2785784.js?file=Generate.sh">// Gist is loading...</script>

<p>Let&#39;s put the a tiny mock haml to both pages&#39; templates to check if everything went well:</p>

<script src="http://gist.github.com/2785784.js?file=Pages mocks.haml">// Gist is loading...</script>

<p>Before we check them in a browser, we have to bind them to the routes. The routes are situated at <code>routes.js.coffee</code> file. Here&#39;s the required routing description:</p>

<script src="http://gist.github.com/2785784.js?file=Routes.coffee">// Gist is loading...</script>

<p>Open your browser and go to: </p>

<div style="text-align:center">
  <pre>http://localhost:3000/blog/</pre>
  <img src="http://f.cl.ly/items/1J1I1S3O3C1J3X3Z2j1G/posts.png" />
  <pre>http://localhost:3000/blog/#!/posts/1</pre>
  <img src="http://f.cl.ly/items/3x0B2i1L3D2V1G0k242B/post.png" />
</div>

<h2>Fetching</h2>

<p>The only thing left to do is to get the real data from the server and put it into the template. Joosy defines <code>fetch</code> hook that should be used to load the required data. Page, Layout and Widget will expect <code>@data</code> to contain a hash of the template&#39;s local variables. So this is how it&#39;s supposed to look:</p>

<script src="http://gist.github.com/2785784.js?file=Fetch.coffee">// Gist is loading...</script>

<p>Now insert the proper variables into your templates:</p>

<script src="http://gist.github.com/2785784.js?file=Pages.haml">// Gist is loading...</script>

<p>That&#39;s it, your pages now contain real data from the server. </p>

<div class="info">
  <p>
    We did not replace the blog post date field. Moreover we don't even have such a field inside our model. This is a good opportunity to practice a bit: try to add this field to your model and templates to consolidate your knowledge.
  </p>
</div>

<p>At this stage we got our Rails backend, Resources and two pages with actual data from server. Now, we go further with <a href="/guides/1.1/en/blog/elements-events-and-filters.html">elements, events and filters</a>.</p>

      </div>
    </article>
  </section>
</div>

    <footer class='container'>
      <div class='pull-left'>
        <p>
          <strong>
            Copyright 2012-2013,
            <a href='http://staal.io'>
              Boris Staal
            </a>
          </strong>
          <br>
          <small>
            <span>
              Hosted at
            </span><a href='http://pages.github.com'>Github Pages</a>,
            <span>
              generated with
            </span><a href='http://jekyllrb.com'>Jekyll</a></small>
        </p>
      </div>
      <div class='pull-right'>
        <p>
          Want to improve something on this site?
          <br><a href='https://github.com/joosy/guides'>Pull requests</a><span>
            are very welcome!
          </span>
        </p>
      </div>
    </footer>
    <a href='https://github.com/joosy/joosy' id='github'>
      <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' style='position: absolute; top: 0; right: 0; border: 0;'>
    </a>
    <script>
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4fb67f54f5a1f56550000016');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
