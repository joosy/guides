<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Forms — Joosy Guides</title>
    <meta charset='utf-8'>
    <link href='http://joosy.ws/application.css' rel='stylesheet'>
    <link href='//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/assets/application-a08ca23316077c59bf0b1e4ef0c2b346.css">
    <script src='http://codeorigin.jquery.com/jquery-1.10.2.min.js' type='text/javascript'></script>
    <script src='//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js' type='text/javascript'></script>
  </head>
  <body>
    <nav class='navbar navbar-inverse'>
      <div class='container'>
        <div class='collapse navbar-collapse'>
          <ul class='nav navbar-nav'>
            <li>
              <a href='http://joosy.ws'>
                Joosy
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Download
              </a>
            </li>
            <li class='active'>
              <a href='http://guides.joosy.ws'>
                Guides
              </a>
            </li>
            <li>
              <a href='http://api.joosy.ws'>
                API
              </a>
            </li>
            <li>
              <a href='http://sample.joosy.ws'>
                Annotated sample
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Screencasts
              </a>
            </li>
            <li>
              <a href='http://github.com/joosy/joosy/issues'>
                Bugs
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Community
              </a>
            </li>
            <li class='twitter'>
              <a href="https://twitter.com/joosy_web" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Twitter</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class='content'>
  <header>
    <div class='container'>
      <img alt='Joosy framework' class='pull-left logo' src='http://joosy.ws/joosy.png'>
      <p class='pull-left'>
        Guides for version 1.1
        <a href='/'>
          Another version or language?
        </a>
      </p>
      <div class='menu pull-right'>
        <ul class='nav nav-pills'>
          <li class=''>
            <a href='/guides/1.1/en'>
              <i class='icon-archive'></i>
              Index
            </a>
          </li>
          <li class='active'>
            <div id='guides'>
              
              <dl class='pull-left'>
  <dt>Joosy basics</dt>
  <dd>
    <a href='/guides/1.1/en/basics/getting-started.html'>Getting Started</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/basics/joosy-vs-x.html'>Joosy vs X</a>
  </dd>
  <dt class='inner'>Creating a blog on Joosy</dt>
  <dd>
    <a href='/guides/1.1/en/blog/rails-preparations.html'>Rails preparations</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/resources.html'>Resources</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/layouts-pages-and-routing.html'>Layouts, Pages and Routing</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/elements-events-and-filters.html'>Elements, Events and Filters</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/dynamic-rendering.html'>Dynamic rendering</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/widgets.html'>Widgets</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/helpers.html'>Helpers</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/forms.html'>Forms</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/preloaders.html'>Preloaders</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/blog/load-unload-and-in-progress-animations.html'>Load, unload, animations</a>
  </dd>
</dl>
<dl class='pull-right'>
  <dt>Advanced guides</dt>
  <dd>
    <a href='/guides/1.1/en/advanced/search-engines-indexing.html'>Search engine indexing</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/authentication.html'>Authentication</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/permissions-and-acl.html'>Permissions and ACL</a>
  </dd>
  <dd>
    <a href='/guides/1.1/en/advanced/how-to-switch-template-engine.html'>Template engines</a>
  </dd>
</dl>

            </div>
            <a class='dropdown-toggle' data-target='#guides' data-toggle='dropdown' href='#guides'>
              <i class='icon-long-arrow-down'></i>
              Guides
            </a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  <section class='main'>
    <article class='entry'>
      <div class='entry-header'>
        <h2></h2>
      </div>
      <div class='entry-content l-en v-1-1'>
        <p>Joosy includes a very powerful tool to make forms handling really comfortable. <code>Joosy.Form</code> wraps your html form and makes it totally AJAXified. No matter if it contains text data or files. So you wrap it and whenever it gets submited you get one of your hooks called (they can be <code>success</code>, <code>error</code>, <code>progress</code>) with the response data passed in.</p>

<p>Besides &quot;AJAXification&quot; it either helps you handle fields management (in conjuction with resources) and invalidation. Both of these will be greatly covered among this chapter.</p>

<h2>Preparations</h2>

<p>To implement creation and modification of posts we&#39;ll have to add two more pages: <code>posts/edit</code> and <code>posts/new</code>.</p>

<script src="http://gist.github.com/2822781.js?file=Generate pages.sh">// Gist is loading...</script>

<p>As before let&#39;s add some routes to ginger our new pages up:</p>

<script src="http://gist.github.com/2822781.js?file=Routes.coffee">// Gist is loading...</script>

<p>Ensure your <code>posts/new</code> route goes <em>before</em> the <code>posts/:id</code> one. Routing always use the first match and id matcher will also consume <code>posts/new</code> if defined first.</p>

<p>Both pages will actually use the same form, so it&#39;s a good candidate to be a partial. Put the following haml in <code>templates/pages/posts/_form.jst.hamlc</code>:</p>

<script src="http://gist.github.com/2822781.js?file=Form.haml">// Gist is loading...</script>

<p>Joosy has a built-in Rails <code>form_for</code> analog and we&#39;ll get back to this in later chapters. But for now having just two fields hand-writen in HAML is not that bad, so we will leave it for now.</p>

<p>Including this partial to both pages is a pretty easy task. Here&#39;s how both of our pages templates are going to look:</p>

<script src="http://gist.github.com/2822781.js?file=Include.haml">// Gist is loading...</script>

<h2>Basic binding</h2>

<p>We&#39;ll work on both pages in parallel since code is going to be quite similar. In real life you will probably want to refactor it, but let&#39;s keep some duplication to maintain simplicity. We are just learning, after all.</p>

<p><code>Joosy.Form</code> works in conjuction with Resource. So what we need to go forward is to get resources for the both pages. And we&#39;ll need to address the form so let&#39;s bind the actual element (TODO: rewrite this sentence).</p>

<script src="http://gist.github.com/2822781.js?file=Fetch.coffee">// Gist is loading...</script>

<p>With this code we&#39;ll make a <code>@data.post</code> to contain the resource for the form for both pages. The next code is absolutely identical for either creation or modification, so just clone it.</p>

<script src="http://gist.github.com/2822781.js?file=Bind.coffee">// Gist is loading...</script>

<p>Go and check. Your forms are ready. Everything else will be covered by inner magic. Even the validation. But to make it work we&#39;ll have to add proper CSS classes and, khm, actually validate something on the server. (TODO: Rewrite this paragraph.)</p>

<h2>Invalidation</h2>

<p>In our case we don&#39;t really need to modify styles since we use the same CSS rule name with Rails. And therefore proper CSS is already specified at <code>scaffold.css.scss</code>. But if you want to give it a better look search for <code>.field_with_errors</code>.(TODO: Either include an example, or drop this paragraph entirely.)</p>

<p>At the server part we&#39;ll have to modify our <code>Post</code> model:</p>

<script src="http://gist.github.com/2822781.js?file=Models.rb">// Gist is loading...</script>

<p>And you can go check your forms again. Invalidated fields will get it&#39;s class and will appear highlighted by CSS rule.</p>

<div class="warning">
  <p>
    Forms are one of the most important parts of Joosy. You really should finish reading this chapter sooner or later. We won't need more info about forms for the whole blog guide though. But you really should come back later even if decide to pass on to a <a href="/guides/blog/dynamic-rendering.html">Dynamic rendering</a> chapter.
  </p>
</div>

<hr class="additional" />

<h2>Basics</h2>

<p>The main goal of <code>Joosy.Form</code> is to turn your forms into AJAX to avoid page reload and improve the control. Resources are secondary. Primaries are:</p>

<ul>
<li>Catch submit, replace it with AJAX query silently</li>
<li>If server responded with 200 parse the JSON response and pass it in to the <code>success</code> callback</li>
<li>If server responded with non-200, parse the JSON response and pass it in to the <code>error</code> callback</li>
<li>If <code>error</code> callback was not defined but we got error, try to highlight invalidations</li>
<li>During form upload call <code>progress</code> callback periodically and pass in the upload progress</li>
</ul>

<p>So the default basic look of <code>attach</code> call is: (TODO: Please clarify this paragraph)</p>

<script src="http://gist.github.com/2822781.js?file=Basic attach.coffee">// Gist is loading...</script>

<p>This call (TODO: what &#39;call&#39;?) will not modify (or set) the method (POST, PUT etc) of the form, it will only affect its action if it was explicitly passed as an <code>action</code> parameter. So if you have no resource for the form you still can &quot;activate&quot; it and unleash the power of success/error/progress callbacks.(TODO: Why?)</p>

<p>While success and progress events are very straightforward, the <code>error</code> hook plays an important role of validation. If this was not specified Joosy will fallback to default validation proccess (which is described below). And more, even if it was specified and did return <code>true</code> explicitly, Joosy will still run it&#39;s validation proccess. This is supposed to ease your form validation handling dramatically.</p>

<p>For the basic form (no resource) validation convention is something really easy. <code>{field: &#39;error message&#39;}</code> – this response will make Joosy seek for <code>input name=field</code> and mark it as invalid. It matches Rails conventions perfectly.</p>

<h2>Resources</h2>

<p>As soon as your form is &quot;attached&quot; you can fill it with the Resource. Do it with <code>form.fill(resource)</code> call. In fact passing the <code>resource</code> parameter to attach is a shortcut to <code>fill</code>. Resource will modify form&#39;s behavior slightly.</p>

<p>At first this will try to fill the form with the actual fields values. Joosy will seek the fields by input names. According to Rails conventions you are supposed to call them <code>model[field]</code>. Same rule applies to Joosy. Earlier in this guide we&#39;ve already seen this convention at our edit form.</p>

<p>At second it will properly modify the action and method of form. If the given resource was new, it gets targeted to POST /models. Otherwise it gets targeted to PUT /models/:id. So you just bind your resource, no matter new or existing and form just works.</p>

<p>The last thing that changes with the resource binding is the invalidation proccess. According to Rails conventions backend will still answer with plain hash <code>{field: &#39;error message&#39;}</code> without reference of model name. Joosy will handle it using the name of the attached resource. So for the invalidation it will seek for <code>input name=&quot;resourceName[field]&quot;</code>.</p>

<div class="info">
  <p>
    Rails is really weak at JSON-reporting of inlined entities validations. It will still answer with plain hash and will omit the details. To make possible automatic validation of complex forms, Joosy will either understand the complex notation:

    <pre>#   { foo: { bar: { baz: ['error'] } } }    # backend response
#   { "foo[bar][baz]": ['error'] }          # field to seek for</pre>
  </p>
</div>

<p>Forms are very important part of Joosy. This chapter gave you the very basics of its possibilities. You can find partial info among other chapters or guides but anyway, please, check out the <a href="http://api.joosy.ws/classes/Joosy/Form.html">API doc</a>. Inside Joosy there&#39;s no other class like this that deserves reading it that much.</p>

<p>Next Chapter - <a href="/guides/1.1/en/blog/dynamic-rendering.html">dynamic rendering</a>.</p>

      </div>
    </article>
  </section>
</div>

    <footer class='container'>
      <div class='pull-left'>
        <p>
          <strong>
            Copyright 2012-2013,
            <a href='http://staal.io'>
              Boris Staal
            </a>
          </strong>
          <br>
          <small>
            <span>
              Hosted at
            </span><a href='http://pages.github.com'>Github Pages</a>,
            <span>
              generated with
            </span><a href='http://jekyllrb.com'>Jekyll</a></small>
        </p>
      </div>
      <div class='pull-right'>
        <p>
          Want to improve something on this site?
          <br><a href='https://github.com/joosy/guides'>Pull requests</a><span>
            are very welcome!
          </span>
        </p>
      </div>
    </footer>
    <a href='https://github.com/joosy/joosy' id='github'>
      <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' style='position: absolute; top: 0; right: 0; border: 0;'>
    </a>
    <script>
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4fb67f54f5a1f56550000016');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
