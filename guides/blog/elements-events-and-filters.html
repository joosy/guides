<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Elements, events and filters â€” Joosy Guides</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/credits.css">
    <link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/default.min.css">
    <script src="http://cachedcommons.org/cache/modernizr/1.5.0/javascripts/modernizr-min.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/prefixfree.min.js"></script>
    <script src="/js/jquery-1.7.2.min.js"></script>
	<script src="/js/jquery.browser.js"></script>
    <script>
      function toggle(element) {
        element.style.display = (element.style.display == 'none') ? 'block' : 'none'
      }
    </script>
  </head>
  <body>
     <div class="topbar">
       <div class="topbar_wrap">
         <table cellpadding="0" cellspacing="0">
		   <tbody>
		     <tr>		    
			   <td><a href="http://joosy.ws">Joosy (1.1.0)</a></td>
			   <td class="disabled"><a href="#" >Who's using</a></td>
  			   <td><a href="http://sample.joosy.ws">Annotated sample</a></td>
			   <td class="active"><a href="http://guides.joosy.ws">Guides</a></td>
			   <td class="disabled"><a href="#" >Screencasts</a></td>
			   <td><a href="http://api.joosy.ws">API</a></td>
			   <td><a href="http://github.com/joosy/joosy">Code</a></td>
			   <td><a href="http://github.com/joosy/joosy/issues">Bugs/Patches</a></td>
			   <td  class="disabled"><a href="#">Community</a></td>
			   <td class="twitter">
  			     <a href="http://twitter.com/joosy_web">Twitter</a>
			     <img src="/img/twit_sign_orange.png" alt="">
			   </td>
		     </tr>
		   </tbody>
	     </table>
       </div>
     </div>
     <header>
      <div class="container">
        <div class="six columns">
          <h1><a href="/">Joosy Guides</a></h1>
        </div>
        <div class="ten columns">
          <ul class="nav">
            <li><a href="/">Home</a></li>
            <li>
              <a href="#" onclick="toggle(document.getElementById('guides'))" class="index">Guides Index &#9660;</a>
              <div style="display: none;" class="clearfix" id="guides">
                <hr />
                <dl class="L">
                  <dt>Joosy basics</dt>
                  <dd><a href="/guides/basics/getting-started.html">Getting Started</a></dd>
                  <dd><a href="/guides/basics/joosy-vs-x.html">Joosy vs X</a></dd>
                  <dt>Creating a blog on Joosy</dt>
                  <dd><a href="/guides/blog/rails-preparations.html">Rails preparations</a></dd>
                  <dd><a href="/guides/blog/resources.html">Resources</a></dd>
                  <dd><a href="/guides/blog/layouts-pages-and-routing.html">Layouts, Pages and Routing</a></dd>
                  <dd><a href="/guides/blog/elements-events-and-filters.html">Elements, Events and Filters</a></dd>
                  <dd><a href="/guides/blog/dynamic-rendering.html">Dynamic rendering</a></dd>
                  <dd><a href="/guides/blog/widgets.html">Widgets</a></dd>
                  <dd><a href="/guides/blog/helpers.html">Helpers</a></dd>
                  <dd><a href="/guides/blog/forms.html">Forms</a></dd>
                  <dd><a href="/guides/blog/preloaders.html">Preloaders</a></dd>
                  <dd><a href="/guides/blog/load-unload-and-in-progress-animations.html">Load, unload, animations</a></dd>
                </dl>
                <dl class="R">
                  <dt>Advanced guides</dt>
                  <dd><a href="/guides/advanced/search-engine-indexing.html">Search engine indexing</a></dd>
                  <dd><a href="/guides/advanded/authentication.html">Authentication</a></dd>
                  <dd><a href="/guides/advanced/permissions.html">Permissions and ACL</a></dd>
                  <dd><a href="/guides/advanced/template-engine.html">Template engines</a></dd>
                </dl>
              </div>
            </li> 
            <li><a href="/contribute.html">Contribute</a></li>
            <li><a href="/credits.html">Credits</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <section class="row">
        <div class="sixteen columns">
          <article class="hentry">
  <div class="entry-header">
    <h2>Elements, events and filters</h2>
  </div>
  <div class="entry-content">
    <div class="info">
  <p>
    In this chapter we will add the most stupid and useless feature of our blog, a digital clock. This clock that will appear when the mouse hits the header pane. While you probably will never do something like this in a real life, this is a very full example for our case.
  </p>
</div>

<p>For the start let&#39;s add a tiny mock to our layout HAML to inspect the future look of the clocks we are working on (Lines 4-7).</p>

<script src="http://gist.github.com/2819730.js?file=Mock layout.haml">// Gist is loading...</script>

<h2>Elements, Events</h2>

<p>Inside your page, layout or widget you can define two lists. The list of DOM elements to wrap into jQuery and put into instance variables, and the list of events to bind to. The first thing we are about to do is to make our mock hide/appear when the mouse reaches <code>.navbar</code>. And since it&#39;s a part of a layout, we are going to work within it. Don&#39;t forget to explicitly set <code>style=&quot;display:none&quot;</code> (TODO: which .css.scss file?) right after you check your mock is in place to make your clocks hidden by default.</p>

<script src="http://gist.github.com/2819730.js?file=Events.coffee">// Gist is loading...</script>

<p>At its keys the <code>elements</code> hash contains the names of instance variables to assign, the values being the actual jQuery DOM selectors. As you can see in this example, it not only defines the instance variables but also allows you to avoid duplication while defining events. </p>

<p>In the events hash you write <code>event_name selector</code> as a key and pass in lambdas (TODO: Example?) to call at this event. At the selector position you are allowed to use <code>$element</code> notation or simply put the full selector as-is: <code>click .foo .bar</code>. The lambdas you define accept two arguments: the first is the actual element the event was triggered on, wguke the second is the full jQuery event object. In our case we don&#39;t need any of them, so they are omited.</p>

<p>Here is the alternative notation that can help your keep your code readable for the complex cases:</p>

<script src="http://gist.github.com/2819730.js?file=Events (complex).coffee">// Gist is loading...</script>

<h2>Filters</h2>

<p>Now is the time to make our clocks alive. Joosy defines set of <code>before</code> and <code>after</code> hooks that are similar to Rails controller filters. To make clocks work we need to put actual time on when the pages load and register a javascript <code>interval</code> to update it every second. Put this code into your <code>ApplicationLayout</code>:(TODO: specify file name)</p>

<script src="http://gist.github.com/2819730.js?file=Filters.coffee">// Gist is loading...</script>

<p>The important thing to note is a <code>@setInterval</code> call. Joosy gives you two wrappers for common <code>setInteval</code> and <code>setTimeout</code> functions. There are two important differences between them and native calls. The first is the arguments order. In Joosy the first argument is the actual timeout/interval delay. Arguments were moved to ease callbacks description for Coffee. And the second difference is the garbage collection. Your interval/timeout will be automatically cleared whenever the container (layout/page/widget) is not active anymore. So you just define the interval and Joosy carries out all the rest.</p>

<p>Together with <code>afterLoad</code> Joosy gives you the <code>beforeLoad</code> hook. Within beforeLoad you don&#39;t have your elements/events assigned nor you have your data fetched. But you can control the page loading flow. As soon as your <code>beforeLoad</code> returned false the page load will be aborted. So you can, for example, redirect user to another page.</p>

<script src="http://gist.github.com/2819730.js?file=Flow control.coffee">// Gist is loading...</script>

<p>Both <code>afterLoad</code> and <code>beforeLoad</code> can be chained. They will be called in the exact order you define those in your container. Moreover, if you use classe inheritance, Joosy will call parents hooks. The order is still under your control. Joosy will start from the upper parent and step down toward the children.</p>

<p>The <a href="/guides/blog/forms.html">next chapter</a> is all about forms. We will finally come up with the way to create and edit blog posts.</p>

  </div>
</article>

        </div>
      </section>
    </div>
    <div id="footer">
        <div class="wrapper">
            <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
            <p>Sources of this guide are available <a href="https://github.com/joosy/guides">on Github</a>.</p>
        </div>
    </div>
    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4fb67f54f5a1f56550000016');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
