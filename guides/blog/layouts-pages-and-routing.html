<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Layouts, pages and routing — Joosy Guides</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/credits.css">
    <link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/default.min.css">
    <script src="http://cachedcommons.org/cache/modernizr/1.5.0/javascripts/modernizr-min.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/prefixfree.min.js"></script>
    <script src="/js/jquery-1.7.2.min.js"></script>
	<script src="/js/jquery.browser.js"></script>
    <script>
      function toggle(element) {
        element.style.display = (element.style.display == 'none') ? 'block' : 'none'
      }
    </script>
  </head>
  <body>
     <div class="topbar">
       <div class="topbar_wrap">
         <table cellpadding="0" cellspacing="0">
		   <tbody>
		     <tr>		    
			   <td><a href="http://joosy.ws">Joosy (1.1.0)</a></td>
			   <td class="disabled"><a href="#" >Who's using</a></td>
  			   <td><a href="http://sample.joosy.ws">Annotated sample</a></td>
			   <td class="active"><a href="http://guides.joosy.ws">Guides</a></td>
			   <td class="disabled"><a href="#" >Screencasts</a></td>
			   <td><a href="http://api.joosy.ws">API</a></td>
			   <td><a href="http://github.com/joosy/joosy">Code</a></td>
			   <td><a href="http://github.com/joosy/joosy/issues">Bugs/Patches</a></td>
			   <td  class="disabled"><a href="#">Community</a></td>
			   <td class="twitter">
  			     <a href="http://twitter.com/joosy_web">Twitter</a>
			     <img src="/img/twit_sign_orange.png" alt="">
			   </td>
		     </tr>
		   </tbody>
	     </table>
       </div>
     </div>
     <header>
      <div class="container">
        <div class="six columns">
          <h1><a href="/">Joosy Guides</a></h1>
        </div>
        <div class="ten columns">
          <ul class="nav">
            <li><a href="/">Home</a></li>
            <li>
              <a href="#" onclick="toggle(document.getElementById('guides'))" class="index">Guides Index &#9660;</a>
              <div style="display: none;" class="clearfix" id="guides">
                <hr />
                <dl class="L">
                  <dt>Joosy basics</dt>
                  <dd><a href="/guides/basics/getting-started.html">Getting Started</a></dd>
                  <dd><a href="/guides/basics/joosy-vs-x.html">Joosy vs X</a></dd>
                  <dt>Creating a blog on Joosy</dt>
                  <dd><a href="/guides/blog/rails-preparations.html">Rails preparations</a></dd>
                  <dd><a href="/guides/blog/resources.html">Resources</a></dd>
                  <dd><a href="/guides/blog/layouts-pages-and-routing.html">Layouts, Pages and Routing</a></dd>
                  <dd><a href="/guides/blog/elements-events-and-filters.html">Elements, Events and Filters</a></dd>
                  <dd><a href="/guides/blog/dynamic-rendering.html">Dynamic rendering</a></dd>
                  <dd><a href="/guides/blog/widgets.html">Widgets</a></dd>
                  <dd><a href="/guides/blog/helpers.html">Helpers</a></dd>
                  <dd><a href="/guides/blog/forms.html">Forms</a></dd>
                  <dd><a href="/guides/blog/preloaders.html">Preloaders</a></dd>
                  <dd><a href="/guides/blog/load-unload-and-in-progress-animations.html">Load, unload, animations</a></dd>
                </dl>
                <dl class="R">
                  <dt>Advanced guides</dt>
                  <dd><a href="/guides/advanced/search-engine-indexing.html">Search engine indexing</a></dd>
                  <dd><a href="/guides/advanded/authentication.html">Authentication</a></dd>
                  <dd><a href="/guides/advanced/permissions.html">Permissions and ACL</a></dd>
                  <dd><a href="/guides/advanced/template-engine.html">Template engines</a></dd>
                </dl>
              </div>
            </li> 
            <li><a href="/contribute.html">Contribute</a></li>
            <li><a href="/credits.html">Credits</a></li>
          </ul>
        </div>
      </div>
    </header>
    <div class="container">
      <section class="row">
        <div class="sixteen columns">
          <article class="hentry">
  <div class="entry-header">
    <h2>Layouts, pages and routing</h2>
  </div>
  <div class="entry-content">
    <p>In Rails each page is the action template. It gets wrapped into the layout and includes a number of partials. As a result you get your HTML generated.</p>

<p>Joosy behaves the same way but unlike its elder brother it has to deal with events and user interaction logic so it&#39;s not just a renderer. Joosy separates the templates layer from a logic level. Logic level consists of the <code>Page</code>, the <code>Layout</code> which wraps the page and set of <code>Widget</code>s that can be included in both, <code>Page</code> and <code>Layout</code>. Each element of the logic level uses templates to describe rendering.</p>

<p><img src="http://f.cl.ly/items/1S130q3C0n1s2R1I1T0S/pages.png" alt=""></p>

<div class="info">
  <p>
    Joosy tries to keep logic elements alive as long as possible. When the new page gets loaded, current layout (object instance, bindings, DOM, included widgets, etc.) will stay untouched unless new pages require another layout. In this case Page will be linked to an existing instance.
  </p>
</div>

<h2>Layouts</h2>

<p>With your first app you got your first page and layout generated. They are situated in</p>

<div class="black_wheel">
  <pre>pages/welcome/index.js.coffee
layouts/application.js.coffee</pre>
</div>

<p>We&#39;ll start from the Layout. The only option it sets makes Joosy look for a template for this layout at <code>templates/layouts/application.jst.hamlc</code>. Since we don&#39;t really need any logic at our Layout for now let&#39;s just modify the HAML. Using twitter bootstrap we can come up with something like this:</p>

<script src="http://gist.github.com/2785784.js?file=Layout.haml">// Gist is loading...</script>

<p>Take a look at the last tricky line. Using <code>{:id =&gt; @yield()}</code> we mark the <code>.container</code> div with the special ID Joosy will use to include page&#39;s HTML. Again, with that, we&#39;ll get page HTML right inside our <code>.container</code> div. And that&#39;s pretty much everything we need from the Layout for now.</p>

<div class="info">
  <p>
    This may look like a silly name 'cause it clearly is not an `yield` in it's real meaning. But wait! Listen! We had a reason to use this name. It helps you to not remember another `longMethodToCall`. It mimics Rails in the closest possible way. 
  </p>
</div>

<h2>Pages</h2>

<p>Let&#39;s move on to the pages. To structure application better we will not use the default pregenerated page (we&#39;ll remove it later) but create a set of new ones! We&#39;ll need three pages: the list of posts, single post view and two forms – to create the post and edit it. We&#39;ll get to modification while working with forms, so now let&#39;s generate the list and view pages:</p>

<script src="http://gist.github.com/2785784.js?file=Generate.sh">// Gist is loading...</script>

<p>Let&#39;s put the a tiny mock haml to both pages&#39; templates to check if everything went well:</p>

<script src="http://gist.github.com/2785784.js?file=Pages mocks.haml">// Gist is loading...</script>

<p>Before we check them in a browser, we have to bind them to the routes. The routes are situated at <code>routes.js.coffee</code> file. Here&#39;s the required routing description:</p>

<script src="http://gist.github.com/2785784.js?file=Routes.coffee">// Gist is loading...</script>

<p>Open your browser and go to: </p>

<div style="text-align:center">
  <pre>http://localhost:3000/blog/</pre>
  <img src="http://f.cl.ly/items/1J1I1S3O3C1J3X3Z2j1G/posts.png" />
  <pre>http://localhost:3000/blog/#!/posts/1</pre>
  <img src="http://f.cl.ly/items/3x0B2i1L3D2V1G0k242B/post.png" />
</div>

<h2>Fetching</h2>

<p>The only thing left to do is to get the real data from the server and put it into the template. Joosy defines <code>fetch</code> hook that should be used to load the required data. Page, Layout and Widget will expect <code>@data</code> to contain a hash of the template&#39;s local variables. So this is how it&#39;s supposed to look:</p>

<script src="http://gist.github.com/2785784.js?file=Fetch.coffee">// Gist is loading...</script>

<p>Now insert the proper variables into your templates:</p>

<script src="http://gist.github.com/2785784.js?file=Pages.haml">// Gist is loading...</script>

<p>That&#39;s it, your pages now contain real data from the server. </p>

<div class="info">
  <p>
    We did not replace the blog post date field. Moreover we don't even have such a field inside our model. This is a good opportunity to practice a bit: try to add this field to your model and templates to consolidate your knowledge.
  </p>
</div>

<p>At this stage we got our Rails backend, Resources and two pages with actual data from server. Now, we go further with <a href="/guides/blog/elements-events-and-filters.html">elements, events and filters</a>.</p>

  </div>
</article>

        </div>
      </section>
    </div>
    <div id="footer">
        <div class="wrapper">
            <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</p>
            <p>Sources of this guide are available <a href="https://github.com/joosy/guides">on Github</a>.</p>
        </div>
    </div>
    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4fb67f54f5a1f56550000016');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
