<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Ресурсы: Подготовка Backend — Joosy Guides</title>
    <meta charset='utf-8'>
    <link href='http://joosy.ws/application.css' rel='stylesheet'>
    <link href='//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/assets/application-a08ca23316077c59bf0b1e4ef0c2b346.css">
    <script src='http://codeorigin.jquery.com/jquery-1.10.2.min.js' type='text/javascript'></script>
    <script src='//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js' type='text/javascript'></script>
  </head>
  <body>
    <nav class='navbar navbar-inverse'>
      <div class='container'>
        <div class='collapse navbar-collapse'>
          <ul class='nav navbar-nav'>
            <li>
              <a href='http://joosy.ws'>
                Joosy
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Download
              </a>
            </li>
            <li class='active'>
              <a href='http://guides.joosy.ws'>
                Guides
              </a>
            </li>
            <li>
              <a href='http://api.joosy.ws'>
                API
              </a>
            </li>
            <li>
              <a href='http://sample.joosy.ws'>
                Annotated sample
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Screencasts
              </a>
            </li>
            <li>
              <a href='http://github.com/joosy/joosy/issues'>
                Bugs
              </a>
            </li>
            <li class='disabled'>
              <a href='javascript:void(0)'>
                Community
              </a>
            </li>
            <li class='twitter'>
              <a href="https://twitter.com/joosy_web" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Twitter</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class='content'>
  <header>
    <div class='container'>
      <img alt='Joosy framework' class='pull-left logo' src='http://joosy.ws/joosy.png'>
      <p class='pull-left'>
        Guides for version 1.2
        <a href='/'>
          Another version or language?
        </a>
      </p>
      <div class='menu pull-right'>
        <ul class='nav nav-pills'>
          <li class=''>
            <a href='/guides/1.2/ru'>
              <i class='icon-archive'></i>
              Index
            </a>
          </li>
          <li class='active'>
            <div id='guides'>
              
              <dl class='pull-left'>
  <dt>Joosy и Rails</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/rails/init.html'>Установка и генераторы</a>
      </li>
    </ul>
  </dd>
  <dt class='inner'>Ресурсы Joosy</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/rails/resources/preparations.html'>Подготовка Backend</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/main.html'>Основные возможности</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/autogeneration.html'>Авто-генерация</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/filters-and-associations.html'>Фильтры и ассоциации</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/pagination.html'>Разбиение на страницы</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/cacher.html'>Cacher</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/identity-map.html'>Identity Map</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/resources/alternate-accessors.html'>Альтернативный интерфейс акцессоров</a>
      </li>
    </ul>
  </dd>
  <dt class='inner'>Рендеринг</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/rails/render/pages-layouts.html'>Страницы и лейауты</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/templates.html'>Шаблоны</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/routing.html'>Роутинг</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/elements-events.html'>Элементы и события</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/forms.html'>Формы</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/filters.html'>Фильтры</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/dynamic-rendering.html'>Динамический рендеринг</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/helpers.html'>Хэлперы</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/widgets-and-modules.html'>Виджеты и модули</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/render/animations.html'>Анимация</a>
      </li>
    </ul>
  </dd>
  <dt class='inner'>Дополнительные возможности</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/rails/advanced/config.html'>Конфигурация Joosy</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/advanced/events.html'>События Joosy</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/rails/advanced/preloading.html'>Предзагрузка JS-файлов</a>
      </li>
    </ul>
  </dd>
</dl>
<dl class='pull-right'>
  <dt>Основы Joosy</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/basics/understanding-joosy.html'>Как устроен Joosy</a>
      </li>
      <li>
        <a href='/guides/1.2/ru/basics/why-joosy.html'>Почему Joosy</a>
      </li>
    </ul>
  </dd>
  <dt class='inner'>Joosy и Node.js</dt>
  <dd>
    <ul>
      <li>
        <a href='/guides/1.2/ru/nodejs/init.html'>Генерация приложения</a>
      </li>
    </ul>
  </dd>
</dl>

            </div>
            <a class='dropdown-toggle' data-target='#guides' data-toggle='dropdown' href='#guides'>
              <i class='icon-long-arrow-down'></i>
              Guides
            </a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  <section class='main'>
    <article class='entry'>
      <div class='entry-header'>
        <h2></h2>
      </div>
      <div class='entry-content l-ru v-1-2'>
        <h2>Ресурсы: Подготовка Backend</h2>

<p>Ресурсами в Joosy называется отображение Backend-моделей. Перед тем как начать работать с ними со стороны Joosy, нам надо подготовиться со стороны сервера. По-умолчанию связка Joosy и Rails использует REST в качестве транспорта. Поэтому нам понадобится несколько моделей, контроллеров CRUD и представлений, которые будут отдавать JSON вместо стандартного HTML.</p>

<h3>Модели</h3>

<p>В блоге мы будем использовать Сообщения и Комментарии, давайте же создадим их незамедлительно!</p>

<div class="highlight"><pre><code class="bash"><span class="lineno">1</span>   rails g scaffold Post title:string body:text comments_count:integer
<span class="lineno">2</span>   rails g scaffold Comment post:references body:text
</code></pre></div>

<p>Установим необходимые связи и добавим капельку исходных данных, что бы было с чем работать.</p>

<h5>app/models/post.rb</h5>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span>   <span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="lineno">2</span>     <span class="n">has_many</span> <span class="ss">:comments</span>
<span class="lineno">3</span>   <span class="k">end</span>
</code></pre></div>

<h5>app/models/comment.rb</h5>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span>   <span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="lineno">2</span>     <span class="n">belongs_to</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:counter_cache</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="lineno">3</span>   <span class="k">end</span>
</code></pre></div>

<h5>db/seeds.rb</h5>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span>   <span class="n">posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">[</span>
<span class="lineno">2</span>     <span class="p">{</span> <span class="ss">title</span><span class="p">:</span> <span class="s1">&#39;Welcome there&#39;</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="s1">&#39;Hey, welcome to the joosy blog example&#39;</span> <span class="p">},</span>
<span class="lineno">3</span>     <span class="p">{</span> <span class="ss">title</span><span class="p">:</span> <span class="s1">&#39;Test post&#39;</span><span class="p">,</span>     <span class="ss">body</span><span class="p">:</span> <span class="s1">&#39;Nothing there. Really&#39;</span> <span class="p">}</span>
<span class="lineno">4</span>   <span class="o">]</span><span class="p">)</span>
<span class="lineno">5</span>   <span class="no">Comment</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">body</span><span class="p">:</span> <span class="s1">&#39;Great article!&#39;</span><span class="p">,</span> <span class="ss">post</span><span class="p">:</span> <span class="n">posts</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</code></pre></div>

<h3>Контроллеры</h3>

<p>Контроллеры, которые генерирует Rails-scaffold нас полностью устраивают. Они являются прямым отображением конвенций Rails, а именно на них и заточен Joosy.</p>

<h3>View</h3>

<p>В то время как рендеринг всего HTML Joosy переносит в браузер, серверу все еще нужны View для того чтобы правильно отдавать нам модели. Для этого мы будем использовать jbuilder. По-умолчанию jbuilder не сериализирует id, поэтому их нужно включить принудительно:</p>

<h5>app/views/posts/index.json.jbuilder</h5>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span>   <span class="n">json</span><span class="o">.</span><span class="n">array!</span><span class="p">(</span><span class="vi">@posts</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
<span class="lineno">2</span>     <span class="n">json</span><span class="o">.</span><span class="n">extract!</span> <span class="n">post</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:comments_count</span>
<span class="lineno">3</span>     <span class="n">json</span><span class="o">.</span><span class="n">url</span> <span class="n">post_url</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span><span class="p">)</span>
<span class="lineno">4</span>   <span class="k">end</span>
</code></pre></div>

<h5>app/views/comments/index.json.jbuilder</h5>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span>   <span class="n">json</span><span class="o">.</span><span class="n">array!</span><span class="p">(</span><span class="vi">@comments</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span>
<span class="lineno">2</span>     <span class="n">json</span><span class="o">.</span><span class="n">extract!</span> <span class="n">comment</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:post_id</span><span class="p">,</span> <span class="ss">:body</span>
<span class="lineno">3</span>     <span class="n">json</span><span class="o">.</span><span class="n">url</span> <span class="n">comment_url</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span><span class="p">)</span>
<span class="lineno">4</span>   <span class="k">end</span>
</code></pre></div>

<p>Запустите <code>rake db:migrate</code> и <code>rake db:seed</code> для настройки БД и фундамент можно считать заложенным.</p>

<ul>
<li><strong><a href="/guides/1.2/ru/">Оглавление</a></strong></li>
<li>&#8592; <a href="/guides/1.2/ru/rails/init.html">Установка и использование генераторов</a></li>
<li>&#8594; <a href="/guides/1.2/ru/rails/resources/main.html">Ресурсы: Основные возможности</a></li>
</ul>

      </div>
    </article>
  </section>
</div>

    <footer class='container'>
      <div class='pull-left'>
        <p>
          <strong>
            Copyright 2012-2013,
            <a href='http://staal.io'>
              Boris Staal
            </a>
          </strong>
          <br>
          <small>
            <span>
              Hosted at
            </span><a href='http://pages.github.com'>Github Pages</a>,
            <span>
              generated with
            </span><a href='http://jekyllrb.com'>Jekyll</a></small>
        </p>
      </div>
      <div class='pull-right'>
        <p>
          Want to improve something on this site?
          <br><a href='https://github.com/joosy/guides'>Pull requests</a><span>
            are very welcome!
          </span>
        </p>
      </div>
    </footer>
    <a href='https://github.com/joosy/joosy' id='github'>
      <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' style='position: absolute; top: 0; right: 0; border: 0;'>
    </a>
    <script>
      var _gauges = _gauges || [];
      (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4fb67f54f5a1f56550000016');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>
  </body>
</html>
